<h2 class="subtitle is-5">Step 1 - Connect to remote processor</h2>

<div id="1_1" class="content substep">
<span class="icon"><i class="fas fa-times-circle"></i></span>
<b>1.1</b> If connected, disconnect remote processor from raspberry pi
<div onclick="complete_1_1()"><span class="icon"><i class="fas fa-check"></i></span> Done</div>
</div>

<div id="1_2" class="content substep">
<span class="icon"><i class="fas fa-times-circle"></i></span>
<b>1.2</b> Connect remote processor to raspberry pi
<div onclick="complete_1_2()"><span class="icon"><i class="fas fa-check"></i></span> Done</div>
</div>

<div id="1_3" class="content substep">
<span class="icon"><i class="fas fa-times-circle"></i></span>
<b>1.3</b> Begin hardware flash
<div onclick="complete_1_3()"><span class="icon"><i class="fas fa-check"></i></span> Begin</div>
<a class="button is-loading"></a>Flashing device
</div>

<script>
  function complete_1_1() {
    const Http = new XMLHttpRequest();
    const url='/remote-processor/setup/1-1';
    Http.open("GET", url);
    Http.send();
    Http.onreadystatechange=function(){
      if (this.readyState == 4) {
        if (this.responseText == 'true'){
          state.substep = 2;
        }
        else {
          alert("Error, please try again");
        }
      }
    }
  }

  var COMPort;
  function complete_1_2() {
    const Http = new XMLHttpRequest();
    const url='/remote-processor/setup/1-2';
    Http.open("GET", url);
    Http.send();
    Http.onreadystatechange=function(){
      if (this.readyState == 4) {
        if (this.responseText != 'false'){
          COMPort = this.responseText.replace(/"/g,'');
          state.substep = 3;
        }
        else {
          alert("Error, please try again");
        }
      }
    }
  }

  function complete_1_3() {
    const Http = new XMLHttpRequest();
    const url='/remote-processor/setup/1-3';
    Http.open("POST", url);
    Http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    Http.send("port=" + COMPort);
    Http.onreadystatechange=function(){
      if (this.readyState == 4) {
        if (this.responseText == "true"){
          state.step = 2;
        } else {
          alert("Failed. Please try again")
        }
      }
    }
  }
</script>
